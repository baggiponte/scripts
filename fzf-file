#!/usr/bin/env zsh

main() {
    requires fd fzf bat nvim

    local FLAGS=(--hidden --no-ignore-vcs --type=file)
    local files="$(fd "${FLAGS[@]}")"

    if [[ -z $files ]]; then
        echo "No files found, exiting..."
        return 1
    fi

    fd "${FLAGS[@]}" | \
    fzf \
        --ansi \
        --tmux=90% \
        --bind="enter:become:nvim -- {}" \
        --bind="ctrl-/:toggle-preview" \
        --preview="bat --style=numbers --color=always -- {}" \
        --preview-window="<80(up)" \
        --query="${*:-}"
}

main "${*:-}"
